{"version":3,"file":"js/534.dfb8d30c.js","mappings":"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","sources":["webpack://vue2_shopping/./src/views/comments/index.vue","webpack://vue2_shopping/src/views/comments/index.vue","webpack://vue2_shopping/./src/views/comments/index.vue?1f18","webpack://vue2_shopping/./src/views/comments/index.vue?16bb","webpack://vue2_shopping/./src/api/comments.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"comments-page\"},[_c('van-nav-bar',{attrs:{\"fixed\":\"\",\"title\":\"商品评价\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.go(-1)}}}),_c('div',{staticClass:\"comments-container\"},[_c('div',{staticClass:\"comment-stats\"},[_c('div',{staticClass:\"rate-box\"},[_c('div',{staticClass:\"rate-num\"},[_vm._v(_vm._s(_vm.goodRate)+\"%\")]),_c('div',{staticClass:\"rate-text\"},[_vm._v(\"好评率\")])]),_c('div',{staticClass:\"tags-box\"},_vm._l((_vm.tags),function(tag,index){return _c('div',{key:index,class:['tag-item', { active: _vm.currentTag === tag.score }],on:{\"click\":function($event){return _vm.switchTag(tag.score)}}},[_vm._v(\" \"+_vm._s(tag.name)+\" (\"+_vm._s(tag.count)+\") \")])}),0)]),_c('div',{staticClass:\"comment-list\"},_vm._l((_vm.commentList),function(item){return _c('div',{key:item.comment_id,staticClass:\"comment-item\"},[_c('div',{staticClass:\"user-info\"},[_c('img',{staticClass:\"avatar\",attrs:{\"src\":item.user.avatar_url || _vm.defaultAvatar}}),_c('span',{staticClass:\"nickname\"},[_vm._v(_vm._s(item.user.nick_name))]),_c('van-rate',{attrs:{\"value\":item.score,\"size\":12,\"color\":\"#ffd21e\",\"void-icon\":\"star\",\"void-color\":\"#eee\",\"readonly\":\"\"}})],1),_c('div',{staticClass:\"comment-content\"},[_vm._v(_vm._s(item.content))]),(item.images && item.images.length)?_c('div',{staticClass:\"comment-images\"},_vm._l((item.images),function(img,imgIndex){return _c('img',{key:imgIndex,attrs:{\"src\":img.image_url},on:{\"click\":function($event){return _vm.previewImage(item.images, imgIndex)}}})}),0):_vm._e(),(item.spec_value)?_c('div',{staticClass:\"comment-spec\"},[_vm._v(_vm._s(item.spec_value))]):_vm._e(),_c('div',{staticClass:\"comment-time\"},[_vm._v(_vm._s(item.create_time))])])}),0),(_vm.loading)?_c('van-loading',{staticClass:\"loading\"},[_vm._v(\"加载中...\")]):_vm._e(),(_vm.finished)?_c('div',{staticClass:\"no-more\"},[_vm._v(\"没有更多评价了\")]):_vm._e()],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"comments-page\">\r\n      <van-nav-bar\r\n        fixed\r\n        title=\"商品评价\"\r\n        left-arrow\r\n        @click-left=\"$router.go(-1)\"\r\n      />\r\n\r\n      <div class=\"comments-container\">\r\n        <!-- 评价统计 -->\r\n        <div class=\"comment-stats\">\r\n          <div class=\"rate-box\">\r\n            <div class=\"rate-num\">{{ goodRate }}%</div>\r\n            <div class=\"rate-text\">好评率</div>\r\n          </div>\r\n          <div class=\"tags-box\">\r\n            <div\r\n              v-for=\"(tag, index) in tags\"\r\n              :key=\"index\"\r\n              :class=\"['tag-item', { active: currentTag === tag.score }]\"\r\n              @click=\"switchTag(tag.score)\"\r\n            >\r\n              {{ tag.name }} ({{ tag.count }})\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 评价列表 -->\r\n        <div class=\"comment-list\">\r\n          <div\r\n            v-for=\"item in commentList\"\r\n            :key=\"item.comment_id\"\r\n            class=\"comment-item\"\r\n          >\r\n          <!-- 用户信息 -->\r\n            <div class=\"user-info\">\r\n              <img :src=\"item.user.avatar_url || defaultAvatar\" class=\"avatar\">\r\n              <span class=\"nickname\">{{ item.user.nick_name }}</span>\r\n              <van-rate\r\n                :value=\"item.score\"\r\n                :size=\"12\"\r\n                color=\"#ffd21e\"\r\n                void-icon=\"star\"\r\n                void-color=\"#eee\"\r\n                readonly\r\n              />\r\n            </div>\r\n            <!-- 评价内容 -->\r\n            <div class=\"comment-content\">{{ item.content }}</div>\r\n            <div class=\"comment-images\" v-if=\"item.images && item.images.length\">\r\n              <img\r\n                v-for=\"(img, imgIndex) in item.images\"\r\n                :key=\"imgIndex\"\r\n                :src=\"img.image_url\"\r\n                @click=\"previewImage(item.images, imgIndex)\"\r\n              >\r\n            </div>\r\n            <!-- 商品规格 -->\r\n            <div class=\"comment-spec\" v-if=\"item.spec_value\">{{ item.spec_value }}</div>\r\n            <div class=\"comment-time\">{{ item.create_time }}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 加载更多 -->\r\n        <van-loading v-if=\"loading\" class=\"loading\">加载中...</van-loading>\r\n        <div v-if=\"finished\" class=\"no-more\">没有更多评价了</div>\r\n      </div>\r\n    </div>\r\n  </template>\r\n\r\n<script>\r\nimport { getCommentList } from '@/api/comments'\r\nimport defaultAvatar from '@/assets/default-avatar.png'\r\n// 实现图片预览\r\nimport { ImagePreview } from 'vant'\r\nexport default {\r\n  name: 'CommentsPage',\r\n  data () {\r\n    return {\r\n      defaultAvatar,\r\n      commentList: [],\r\n      currentTag: -1,\r\n      page: 1,\r\n      loading: false,\r\n      finished: false,\r\n      tags: [\r\n        { name: '全部', count: 0, score: -1 },\r\n        { name: '好评', count: 0, score: 10 },\r\n        { name: '中评', count: 0, score: 20 },\r\n        { name: '差评', count: 0, score: 30 }\r\n      ]\r\n    }\r\n  },\r\n  created () {\r\n    this.loadComments()\r\n  },\r\n  computed: {\r\n    goodsId () {\r\n      return this.$route.query.goodsId\r\n    },\r\n    goodRate () {\r\n      console.log(this.tags[0].count)\r\n\r\n      return ((this.tags[1].count / this.tags[0].count) * 100).toFixed(2)\r\n    }\r\n  },\r\n  methods: {\r\n    async loadComments () {\r\n      if (this.loading || this.finished) return\r\n\r\n      this.loading = true\r\n      try {\r\n        const { data: { list } } = await getCommentList(this.currentTag, this.goodsId, this.page)\r\n\r\n        console.log(list.data)\r\n        this.tags[0].count = list.total\r\n        console.log(this.tags[0].count)\r\n\r\n        // 更新评价标签数量\r\n        list.data.forEach(item => {\r\n          if (item.score) {\r\n            if (item.score < 20) this.tags[1].count++\r\n            if (item.score < 30 && item.score >= 20) this.tags[2].count++\r\n            if (item.score < 40 && item.score >= 30) this.tags[3].count++\r\n          }\r\n        })\r\n\r\n        // 追加评价列表 加载更多时 将数据增加到原有数据的后面\r\n        this.commentList = [...this.commentList, ...list.data]\r\n\r\n        // 判断是否加载完成\r\n        if (this.commentList.length >= list.total) {\r\n          this.finished = true\r\n        } else {\r\n          this.page++\r\n        }\r\n      } catch (error) {\r\n        console.error('获取评价列表失败：', error)\r\n        this.$toast('加载失败，请重试')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    switchTag (tag) {\r\n      if (this.currentTag === tag) return\r\n      this.currentTag = tag\r\n      this.page = 1\r\n      this.commentList = []\r\n      this.finished = false\r\n      this.loadComments()\r\n    },\r\n    // 实现图片预览功能\r\n    previewImage (images, index) {\r\n      console.log(images)\r\n\r\n      const urls = images.map(img => img.image_url)\r\n      ImagePreview({\r\n        images: urls,\r\n        startPosition: index\r\n      })\r\n    }\r\n  },\r\n  mounted () {\r\n    // 监听滚动到底部\r\n    const container = document.querySelector('.comments-container')\r\n    container.addEventListener('scroll', () => {\r\n      const { scrollHeight, scrollTop, clientHeight } = container\r\n      if (scrollHeight - scrollTop - clientHeight < 50) {\r\n        this.loadComments()\r\n      }\r\n    })\r\n  }\r\n}\r\n</script>\r\n\r\n  <style lang=\"less\" scoped>\r\n  .comments-page {\r\n    min-height: 100vh;\r\n    background: #f5f5f5;\r\n  }\r\n\r\n  .comments-container {\r\n    padding-top: 46px;\r\n    height: 100vh;\r\n    overflow-y: auto;\r\n    -webkit-overflow-scrolling: touch;\r\n  }\r\n\r\n  .comment-stats {\r\n    background: #fff;\r\n    padding: 15px;\r\n    margin-bottom: 10px;\r\n\r\n    .rate-box {\r\n      text-align: center;\r\n      margin-bottom: 15px;\r\n\r\n      .rate-num {\r\n        font-size: 24px;\r\n        color: #f44;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .rate-text {\r\n        font-size: 12px;\r\n        color: #999;\r\n        margin-top: 5px;\r\n      }\r\n    }\r\n\r\n    .tags-box {\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      gap: 10px;\r\n\r\n      .tag-item {\r\n        padding: 5px 12px;\r\n        border-radius: 15px;\r\n        background: #f5f5f5;\r\n        font-size: 12px;\r\n        color: #666;\r\n\r\n        &.active {\r\n          background: #fff1f1;\r\n          color: #f44;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .comment-list {\r\n    .comment-item {\r\n      background: #fff;\r\n      padding: 15px;\r\n      margin-bottom: 10px;\r\n\r\n      .user-info {\r\n        display: flex;\r\n        align-items: center;\r\n        margin-bottom: 10px;\r\n\r\n        .avatar {\r\n          width: 30px;\r\n          height: 30px;\r\n          border-radius: 50%;\r\n          margin-right: 8px;\r\n        }\r\n\r\n        .nickname {\r\n          font-size: 14px;\r\n          color: #333;\r\n          margin-right: 8px;\r\n        }\r\n      }\r\n\r\n      .comment-content {\r\n        text-align: left;\r\n        font-size: 14px;\r\n        color: #333;\r\n        line-height: 1.5;\r\n        margin-bottom: 10px;\r\n      }\r\n\r\n      .comment-images {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 5px;\r\n        margin-bottom: 10px;\r\n\r\n        img {\r\n          width: 80px;\r\n          height: 80px;\r\n          object-fit: cover;\r\n          border-radius: 4px;\r\n        }\r\n      }\r\n\r\n      .comment-spec {\r\n        text-align: left;\r\n        font-size: 12px;\r\n        color: #999;\r\n        margin-bottom: 5px;\r\n      }\r\n\r\n      .comment-time {\r\n        text-align: left;\r\n        font-size: 12px;\r\n        color: #999;\r\n      }\r\n    }\r\n  }\r\n\r\n  .loading,\r\n  .no-more {\r\n    text-align: center;\r\n    color: #999;\r\n    font-size: 12px;\r\n    padding: 15px 0;\r\n  }\r\n  </style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=0d0c10aa&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0d0c10aa&prod&lang=less&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0d0c10aa\",\n  null\n  \n)\n\nexport default component.exports","import request from '@/utils/request'\r\n\r\n// 获取商品评价\r\nexport const getComments = (goodsId, limit) => {\r\n  return request.get('/comment/listRows', {\r\n    params: {\r\n      goodsId,\r\n      limit: 3 // 默认展示3条\r\n    }\r\n  })\r\n}\r\n\r\n// 获取商品评价列表\r\nexport const getCommentList = (scoreType, goodsId, page) => {\r\n  return request.get('/comment/list', {\r\n    params: {\r\n      scoreType,\r\n      goodsId,\r\n      page\r\n    }\r\n  })\r\n}\r\n"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","$event","$router","go","_v","_s","goodRate","_l","tags","tag","index","key","class","active","currentTag","score","switchTag","name","count","commentList","item","comment_id","user","avatar_url","defaultAvatar","nick_name","content","images","length","img","imgIndex","image_url","previewImage","_e","spec_value","create_time","loading","finished","staticRenderFns","data","page","created","loadComments","computed","goodsId","$route","query","console","log","toFixed","methods","list","getCommentList","total","forEach","error","$toast","urls","map","_ImagePreview","startPosition","mounted","container","document","querySelector","addEventListener","scrollHeight","scrollTop","clientHeight","component","getComments","limit","request","get","params","scoreType"],"sourceRoot":""}