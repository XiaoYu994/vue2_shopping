"use strict";(self["webpackChunkvue2_shopping"]=self["webpackChunkvue2_shopping"]||[]).push([[933],{2933:function(t,e,i){i.r(e),i.d(e,{default:function(){return v}});i(4114);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order"},[e("van-nav-bar",{attrs:{title:"我的订单","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),e("van-tabs",{model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[e("van-tab",{attrs:{name:"all",title:"全部"}}),e("van-tab",{attrs:{name:"payment",title:"待支付"}}),e("van-tab",{attrs:{name:"delivery",title:"待发货"}}),e("van-tab",{attrs:{name:"received",title:"待收货"}}),e("van-tab",{attrs:{name:"comment",title:"待评价"}})],1),e("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[t.list.length?t._l(t.list,(function(i){return e("OrderListItem",{key:i.order_id,attrs:{item:i},on:{"click-item":function(e){return t.$router.push(`/order/detail/${i.order_id}`)},"on-cancel":t.handleCancel,"on-pay":t.handlePay,"on-confirm":t.handleConfirm,"on-comment":t.handleComment}})})):e("van-empty",{staticClass:"custom-empty",attrs:{image:"https://fastly.jsdelivr.net/npm/@vant/assets/custom-empty-image.png",description:t.emptyText},scopedSlots:t._u([{key:"bottom",fn:function(){return[e("van-button",{staticClass:"bottom-button",attrs:{round:"",type:"danger"},on:{click:function(e){return t.$router.push("/home")}}},[t._v(" 去逛逛 ")])]},proxy:!0}])})],2)],1)],1)},a=[],n=(i(8992),i(3949),i(1454),i(8872),i(4180)),r=i(7167),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"order-item",on:{click:function(e){return t.$emit("click-item")}}},[e("div",{staticClass:"tit"},[e("div",{staticClass:"time"},[t._v(t._s(t.item.create_time))]),e("div",{staticClass:"status"},[e("span",{class:{warning:t.isWarningStatus}},[t._v(t._s(t.item.state_text))])])]),e("div",{staticClass:"list"},t._l(t.item.goods,(function(i,s){return e("div",{key:s,staticClass:"list-item"},[e("div",{staticClass:"goods-img"},[e("img",{attrs:{src:i.goods_image,alt:""}})]),e("div",{staticClass:"goods-content text-ellipsis-2"},[t._v(" "+t._s(i.goods_name)+" ")]),e("div",{staticClass:"goods-trade"},[e("p",[t._v("¥ "+t._s(i.total_pay_price))]),e("p",[t._v("x "+t._s(i.total_num))])])])})),0),e("div",{staticClass:"total"},[t._v(" 共"+t._s(t.item.total_num)+"件商品，总金额 ¥"+t._s(t.item.total_price)+" ")]),e("div",{staticClass:"actions"},[10===t.item.order_status?e("div",[10===t.item.pay_status?e("span",{staticClass:"primary urgent",on:{click:function(e){return e.stopPropagation(),t.$emit("on-pay",t.item.order_id)}}},[t._v("立刻付款")]):t._e(),10===t.item.delivery_status?e("span",{on:{click:function(e){return e.stopPropagation(),t.$emit("on-cancel",t.item.order_id)}}},[t._v("申请取消")]):t._e(),20===t.item.delivery_status||30===t.item.delivery_status?e("span",{staticClass:"primary",on:{click:function(e){return e.stopPropagation(),t.$emit("on-confirm",t.item.order_id)}}},[t._v("确认收货")]):t._e()]):t._e(),30===t.item.order_status?e("div",[e("span",{staticClass:"primary",on:{click:function(e){return e.stopPropagation(),t.$emit("on-comment",t.item.order_id)}}},[t._v("评价")])]):t._e()])])},c=[],l={props:{item:{type:Object,default:()=>({})}},computed:{isWarningStatus(){return[0,10].includes(this.item.order_status)}}},d=l,u=i(1656),m=(0,u.A)(d,o,c,!1,null,"64daa362",null),h=m.exports,p={name:"OrderPage",components:{OrderListItem:h},data(){return{active:this.$route.query.dataType||"all",page:1,list:[],loading:!1,finished:!1,refreshing:!1,pageSize:10}},computed:{emptyText(){const t={all:"暂无订单",payment:"暂无待支付订单",delivery:"暂无待发货订单",received:"暂无待收货订单",comment:"暂无待评价订单"};return t[this.active]||"暂无订单"}},created(){this.getOrderList()},methods:{async getOrderList(t=!1){try{t&&(this.page=1,this.finished=!1);const{data:{list:e}}=await(0,n.n7)(this.active,this.page),{data:i,total:s}=e,a=i.map((t=>({...t,total_num:t.goods.reduce(((t,e)=>t+e.total_num),0)})));if(t)this.list=a;else{const t=[...this.list];a.forEach((e=>{const i=t.findIndex((t=>t.order_id===e.order_id));-1===i?t.push(e):t[i]=e})),this.list=t}this.page++,this.loading=!1,this.list.length>=s&&(this.finished=!0)}catch(e){console.error("获取订单列表失败：",e),this.$toast.fail("获取订单列表失败"),this.loading=!1}},async handleCancel(t){this.$dialog.confirm({title:"提示",message:"确认取消订单吗？"}).then((async()=>{await(0,n.ZT)(t),this.$toast.success("取消成功"),setTimeout((()=>{this.getOrderList()}),500)})).catch((()=>{}))},async handlePay(t){if(!this.loginConfirm())try{await(0,n.Tg)(t),this.$toast.success("支付成功"),this.getOrderList()}catch(e){this.$toast.fail("支付失败")}},async handleConfirm(t){try{await this.$dialog.confirm({title:"确认收货",message:"确认已收到商品吗？"}),await(0,n.JW)(t),this.$toast.success("确认收货成功"),this.getOrderList()}catch(e){if("cancel"===e)return;this.$toast.fail("确认收货失败")}},handleComment(t){this.$router.push(`/comment/${t}`)},onLoad(){this.getOrderList()},onRefresh(){this.getOrderList(!0),this.refreshing=!1}},watch:{active:{handler(){this.refreshing=!0,this.onRefresh()}}},mixins:[r.A]},f=p,g=(0,u.A)(f,s,a,!1,null,"6da5b478",null),v=g.exports},4180:function(t,e,i){i.d(e,{Fs:function(){return n},J$:function(){return a},JW:function(){return c},Tg:function(){return l},ZT:function(){return o},n7:function(){return r}});var s=i(5720);const a=(t,e)=>s.A.post("/checkout/submit",{mode:t,delivery:10,couponId:0,isUsePoints:0,payType:10,...e}),n=(t,e)=>s.A.get("/checkout/order",{params:{mode:t,delivery:10,couponId:0,isUsePoints:0,...e}}),r=(t,e)=>s.A.get("/order/list",{params:{dataType:t,page:e}}),o=t=>s.A.post("/order/cancel",{orderId:t}),c=t=>s.A.post("/order/receipt",{orderId:t}),l=t=>s.A.post("/order/pay",{orderId:t,payType:10})},7167:function(t,e){e.A={methods:{loginConfirm(){return!this.$store.getters.token&&(this.$dialog.confirm({title:"温馨提示",message:"还没登录呢蠢货",confirmButtonText:"去登陆",cancelButtonText:"再逛逛"}).then((()=>{this.$router.replace({path:"/login",query:{backUrl:this.$route.fullPath}})})).catch((()=>{})),!0)}}}}}]);
//# sourceMappingURL=933.69926a11.js.map